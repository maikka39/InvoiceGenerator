<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>invoiceGenerator - Sjabloon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/bulma.css">
    <script defer src="./js/font-awesome.js"></script>
</head>

<body class="is-unselectable">
    <section class="hero is-primary is-fullheight">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Uitkomst
                </h1>
                <h2 class="subtitle">
                    Dit is wat er is gegenereerd op basis van de gegevens en het calculatiesheet. U kunt het nu downloaden en verzenden!
                </h2>
                <div class="level">
                    <div class="level-item">
                        <button class="button is-full-width has-margin-right-20" onclick="downloadInvoice()"><i class="fas fa-download"></i> &nbsp; Download Offerte</button>
                    </div>
                    <div class="level-item">
                        <button disabled class="button is-full-width has-margin-left-20"><i class="fas fa-download"></i> &nbsp; Download Calculatiesheet</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript">
    // Connect to the backend
    const {
      remote
    } = require('electron');

    // Get the values
    const values = remote.require('./backend/values').get();


    // Set the date variable
    let date = new Date();

      /**
       * Get the URL parameters
       * @return {Object} - The URL parameters
       */
      function getParams () {
        // Create a dictionary for the parameters
        var params = {};
        // Create a parser element
        var parser = document.createElement('a');
        // Link it to this page
        parser.href = window.location.href;
        // Get the second substring
        var query = parser.search.substring(1);
        // Split it on the different variables
        var vars = query.split('&');
        // Loop through them
        for (var i = 0; i < vars.length; i++) {
          // Split the variable at the '=' sign
          var pair = vars[i].split('=');
          // Create an entry in the params variable for the variable
          params[pair[0]] = decodeURIComponent(pair[1]);
        }
        // Send back the parameters
        return params;
      };

      /**
       * Upload a file to the user.
       * @param {string} link - The link to the file which should be downloaded.
       * @param {string} filename - The name with which the file should be saved.
       */
      function download(link, filename) {
        // Create an anchor element
        var element = document.createElement('a');
        // Point the href to the link
        element.setAttribute('href', link);
        // Set the download attribute so it will download and not open
        // Also, set it to the filename which is then automatically filled in when the user downloads the file
        element.setAttribute('download', filename);

        // Hide the element so the user doesn't see it
        element.style.display = 'none';
        // Add it to the body of the html
        document.body.appendChild(element);

        // Simulate a click on the element
        element.click();

        // Then remove it
        document.body.removeChild(element);
      }

      /**
       * Upload the invoice to the user
       */
      function downloadInvoice() {
        // Upload the file to the user
        // window.location.href = "../output/" + getParams()["invoiceFilename"];
        download("../output/" + getParams()["invoiceFilename"], "offerte_" + date.getFullYear() + "_" + date.getMonth() + "_" + date.getDate() + "_" + values["client"]["company"].replace(/[^a-zA-Z0-9]/g, '_') + ".docx")

      }
    </script>

</body>

</html>
