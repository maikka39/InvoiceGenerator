<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>IG - Options</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script defer src="./js/font-awesome.js"></script>
    <script type="text/javascript"
        src="./js/bulma-accordion.min.js"></script>
    <link rel="stylesheet" href="./css/options.css">
    <link rel="stylesheet" href="./css/bulma-accordion.min.css">
    <link rel="stylesheet" href="./css/bulma-checkradio.min.css">
    <link rel="stylesheet" href="./css/bulma.css">
</head>

<body class="is-unselectable">
    <section class="hero is-primary">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Opties
                </h1>
                <h2 class="subtitle">
                    Kies en vul in wat voor deze offerte geldt
                </h2>
            </div>
        </div>
    </section>
    <div class="columns has-margin-top-20">
        <div class="column template-item is-one-third">
            <div class="column-content has-margin-left-40 has-margin-right-40">
                <div class="level">
                    <div class="level-left">
                        <h1 class="title is-5">Klant</h1>
                    </div>
                    <div class="level-right">
                        <div class="dropdown is-hoverable">
                          <div class="dropdown-trigger">
                            <button class="button is-danger has-cursor-pointer is-small is-rounded"><i class="fas fa-folder-open"></i> &nbsp;
                                Open &nbsp; <i class="fa fa-angle-down"></i></button>
                          </div>
                          <div class="dropdown-menu" id="dropdown-menu4" role="menu">
                            <div class="dropdown-content">
                                <div class="dropdown-item" onclick="selectSavedClient(this.children[0].innerText)" style="cursor: pointer;">
                                  <a>Bedrijfsnaam</a>
                                </div>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
                <form onsubmit="return submitForm(this);">
                  <div class="field">
                      <label class="label">Bedrijf</label>
                      <div class="control">
                          <input class="input client_field" type="text" name="company" placeholder="Bedrijfsnaam" required>
                      </div>
                  </div>
                  <div class="field">
                      <label class="label">Contactpersoon</label>
                      <div class="control">
                          <input class="input client_field" type="text" name="salutation" placeholder="Aanhef" required>
                          <input class="input client_field" type="text" name="firstname" placeholder="Voornaam" required>
                          <input class="input client_field" type="text" name="insertion" placeholder="Tussenvoegsel" required>
                          <input class="input client_field" type="text" name="lastname" placeholder="Achternaam" required>
                      </div>
                  </div>
                  <div class="field">
                      <label class="label">E-Mail</label>
                      <div class="control">
                          <input class="input client_field" type="text" name="email" placeholder="E-Mail" required>
                      </div>
                  </div>
                  <div class="field">
                      <label class="label">Adres</label>
                      <div class="control">
                          <input class="input client_field" type="text" name="street" placeholder="Straatnaam" required>
                          <input class="input client_field" type="text" name="postalcode" placeholder="Postcode" required>
                          <input class="input client_field" type="text" name="city" placeholder="Plaats" required>
                      </div>
                  </div>
                  <button type="submit" class="button is-primary">Opslaan</button>
                </form>
            </div>
        </div>
        <div class="column has-margin-left-40 has-margin-right-40 template-item has-margin-top-10">
            <h1 class="title is-5">Products</h1>
            <section class="accordions">
                <article class="accordion">
                    <div class="accordion-header toggle">
                        <div class="image is-32x32"><img src="./img/icon.png" alt=""></div>
                            <p>Balk - #1234</p>
                            <span class="delete"></span>
                    </div>
                    <div style="overflow-x: scroll" class="accordion-body">
                        <div  class="accordion-content">
                            <div class="field">
                                <div class="field">
                                    <label class="label">Hoeveelheid</label>
                                    <div class="control">
                                        <input class="input" type="text" placeholder="Example">
                                    </div>
                                </div>
                                <input class="is-checkradio is-block is-danger" id="example" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example">voorbeeld</label>
                                <input class="is-checkradio is-block is-primary" id="example2" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example2">voorbeeld</label>
                                <input class="is-checkradio is-block is-danger" id="example3" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example3">voorbeeld</label>
                                <input class="is-checkradio is-block is-danger" id="example5" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example5">voorbeeld</label>
                            </div>
                        </div>
                    </div>
                </article>
                <article class="accordion">
                    <div class="accordion-header toggle">
                        <div class="image is-32x32"><img src="./img/icon.png" alt=""></div>
                            <p>Plank - #MZ1234</p>
                            <span class="delete"></span>
                    </div>
                    <div style="overflow-x: scroll" class="accordion-body">
                        <div  class="accordion-content">
                            <div class="field">
                                <div class="field">
                                    <label class="label">Hoeveelheid</label>
                                    <div class="control">
                                        <input class="input" type="text" placeholder="Example">
                                    </div>
                                </div>
                                <input class="is-checkradio is-block is-danger" id="example6" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example6">voorbeeld</label>
                                <input class="is-checkradio is-block is-primary" id="example7" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example7">voorbeeld</label>
                                <input class="is-checkradio is-block is-danger" id="example8" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example8">voorbeeld</label>
                                <input class="is-checkradio is-block is-danger" id="example9" type="checkbox"
                                    name="exampleCheckbox" checked="checked">
                                <label for="example9">voorbeeld</label>
                            </div>
                        </div>
                    </div>
                </article>
            </section>
            <article class="new button is-primary is-full-width has-text-centered">
                <h1 class="title is-6" style="color: white;">Nieuw +</h1>
            </article>
        </div>

    </div>
  <script type="text/javascript">
    // Connect to the backend
    const {
      remote
    } = require('electron');

    // Load the values script
    const values = remote.require('./backend/values');
    const fs = remote.require('fs');

    // Read the clients file
    fs.readFile('./backend/clients.json', (err, data) => {
      // If there is an error, throw it
      if (err) throw err;
      // Parse the json file
      let clients = JSON.parse(data);

      // Get the dropdown menu
      let dropdown = document.getElementById('dropdown-menu4').children[0];

      // For every client in the json file
      for (let client in clients) {
        // Check if the client actually exists
        if (clients.hasOwnProperty(client)) {
          // Create a clone of the standard option
          let cln = dropdown.children[0].cloneNode(true);
          // Set the text to the client name
          cln.children[0].innerText = client;
          // Append the editted clone the the parent
          dropdown.appendChild(cln);
        }
      }

      // Remove the initial option
      dropdown.removeChild(dropdown.children[0]);

    });

    /**
     * Select a client from a previous invoice.
     * @param {string} name - The name of the preset company.
     */
    function selectSavedClient(name) {
      // Read the clients file
      fs.readFile('./backend/clients.json', (err, data) => {
        // If there is an error, throw it
        if (err) throw err;
        // Parse the json file
        let clients = JSON.parse(data);

        // If the name is in the client list
        if (clients.hasOwnProperty(name)) {
          // Get the client object
          let client = clients[name]
          // Get all the fields
          let fields = document.getElementsByClassName('client_field');

          // For every field
          for (var i = 0; i < fields.length; i++) {
            // If the client has that property set
            if (client.hasOwnProperty(fields[i].name)) {
              // Set the correct value
              fields[i].value = client[fields[i].name];
            } else {
              // Otherwise make it blank
              fields[i].value = " ";
            }
          }
        } else {
          // If not, tell the user something went wrong
          alert("Sorry, er is iets mis gegaan.")
        }
      });
    }

    /**
     * Submit a form to the backend.
     * @param {Object} form - The form which should be submitted to the backend.
     */
    function submitForm(el) {
      // Declare client_data
      let client_data = {};

      // Iterate through all the children of the form
      for (let i = 0; i < el.children.length; i++) {
        // If the element has the set class
        if (el.children[i].classList.contains('field')) {
          // Iterate through all the children of that class
          for (let j = 0; j < el.children[i].children.length; j++) {
            // If the element has the set class
            if (el.children[i].children[j].classList.contains('control')) {
              // Iterate through all the children of that class
              for (let k = 0; k < el.children[i].children[j].children.length; k++) {
                // If the element is of the type input
                if (el.children[i].children[j].children[k].tagName.toLowerCase() === "input") {
                  // Set it to a variable
                  let input = el.children[i].children[j].children[k];
                  // And add it to the data
                  client_data[input.name] = input.value;
                }
              };
            }
          };
        }
      };
      // Send the client data to the backend
      values.set("client", client_data);

      values.log();

      // Save as company
      fs.readFile('./backend/clients.json', (err, data) => {
        if (err) throw err;
        let clients = JSON.parse(data);

        clients[client_data.company] = client_data;

        let new_data = JSON.stringify(clients, null, 2);

        fs.writeFile('./backend/clients.json', new_data, (err) => {
          if (err) throw err;
            console.log('Data written to file');
        });
      });

      // Prevent the form from submitting
      return false;
    };
  </script>
</body>

<script>
    var accordions = bulmaAccordion.attach();
</script>

</html>
